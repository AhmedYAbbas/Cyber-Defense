using System;
using UnityEngine;
using UnityEngine.AI;
using UnityEngine.UI;

public class Malware : MonoBehaviour
{
    // Private
    [SerializeField] private MalwareData _malwareData;
    private NavMeshAgent _malware;


    // Public 
    [HideInInspector] public string Name;
    [HideInInspector] public int AttackDamage;
    [HideInInspector] public int MovementSpeed;
    [HideInInspector] public int Health;
    [HideInInspector] public int Shield;
    [HideInInspector] public int EnergyCost;
    [HideInInspector] public bool IsRanged;
    private float _currentHealth;
    [SerializeField] private GameObject targetingSystem;
    [SerializeField] private Slider healthBarSlider;

    void Start()
    {
        _malware = GetComponent<NavMeshAgent>();
        this.GetComponent<Renderer>().material.color = _malwareData.CardColor;
        name = _malwareData.MalwareName;
        AttackDamage = _malwareData.AttackDamage;
        MovementSpeed = _malwareData.MovementSpeed;
        EnergyCost = _malwareData.EnergyCost;
        Health = _malwareData.Health;
        Shield = _malwareData.Shield;
        IsRanged = _malwareData.IsRanged;
        _malware.speed = MovementSpeed;
        //_currentHealth = Health;
        _currentHealth = Health;
        healthBarSlider.value = 1;
    }

    private void OnEnable()
    {
        _currentHealth = Health;
        healthBarSlider.value = 1;
        targetingSystem.SetActive(true);
    }

    private void OnDisable()
    {
        targetingSystem.SetActive(false);
    }

    public void DamageMalware(int dmg)
    {
        _currentHealth -= dmg;
        UpdateHealthBar();
        if (_currentHealth <= 0)
        {
            //DestroyImmediate(gameObject);
            gameObject.SetActive(false);
        }
    }

    private void UpdateHealthBar()
    {
        float healthPercentage = (_currentHealth / Health) * 100;
        healthBarSlider.value = healthPercentage / 100;
    }
}